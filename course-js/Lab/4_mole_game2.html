<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Whack-a-Mole</title>
    <style>
      .board {
        display: grid;
        grid-template-columns: repeat(10, 100px);
        gap: 10px;
        margin-bottom: 10px;
      }
      .cell {
        width: 100px;
        height: 100px;
        background: #ddd;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 40px;
        cursor: pointer;
      }
      .mole {
        background: gold;
      }
    </style>
  </head>
  <body>
    <h2>ë‘ë”ì§€ ì¡ê¸° ê²Œì„2</h2>
    <div>ì ìˆ˜: <span id="score">0</span></div>
    <div>Miss: <span id="miss">0</span></div>
    <button id="startBtn">ê²Œì„ ì‹œì‘</button>

    <div class="board" id="board"></div>

    <script>
      const board = document.getElementById("board");
      const scoreEl = document.getElementById("score");
      const missEl = document.getElementById("miss");
      const startBtn = document.getElementById("startBtn");

      let score = 0;
      let miss = 0;
      let timer = null;
      let timeoutId = null;
      let currentIndex = -1;

      // 1. ë³´ë“œ ìƒì„± (DOM Create)
      /*
      [ë¬¸ì œ 1]
      - 9ê°œì˜ ì…€(div)ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ boardì— ì¶”ê°€í•œë‹¤.
      - ê° ì…€ì— classNameìœ¼ë¡œ "cell"ì„ ì§€ì •í•œë‹¤.
      - ê° ì…€ì— dataset.indexë¡œ 0~8ê¹Œì§€ì˜ ì¸ë±ìŠ¤ë¥¼ ì €ì¥í•œë‹¤.
      - board.appendChild()ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•œ divë¥¼ boardì— ì¶”ê°€í•œë‹¤.

      â€» íŒíŠ¸:
      - document.createElement("div")
      - div.className = "cell"
      - div.dataset.index = i
      - board.appendChild(div)
      */
      // indexì™€ boardìš”ì†Œ ì „ë‹¬
      function createCell(argIdx) {
        // ìš”ì†Œ ìƒì„±
        const div = document.createElement("div");
        div.className = "cell";
        // index ì €ì¥
        div.dataset.index = argIdx;
        // ìƒì„±í•œ div ë°˜í™˜
        return div;
      }
      // 9ë²ˆ ë°˜ë³µ -> boardì— ì¶”ê°€
      const cells = [];
      for (let i = 0; i < 100; i++) {
        const cell = createCell(i)
        board.appendChild(cell);
        cells.push(cell);
      }
      // 2. ëœë¤ ë‘ë”ì§€ ë“±ì¥
      /*
      [ë¬¸ì œ 2]
      - ëª¨ë“  ì…€ì—ì„œ ë‘ë”ì§€ë¥¼ ì œê±°í•œë‹¤ (mole í´ë˜ìŠ¤ ì œê±°, í…ìŠ¤íŠ¸ ë¹„ìš°ê¸°).
      - 0 ~ 8 ì‚¬ì´ì˜ ëœë¤í•œ ìˆ«ìë¥¼ ìƒì„±í•œë‹¤.
      - ëœë¤í•˜ê²Œ ì„ íƒëœ ì…€ì— "mole" í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³ , ğŸ¹ ì´ëª¨ì§€ë¥¼ í‘œì‹œí•œë‹¤.
      - currentIndex ë³€ìˆ˜ì— í˜„ì¬ ë‘ë”ì§€ ìœ„ì¹˜ë¥¼ ì €ì¥í•œë‹¤.

      â€» íŒíŠ¸:
      - cells.forEach()ë¡œ ëª¨ë“  ì…€ ìˆœíšŒ
      - c.classList.remove("mole"), c.textContent = ""
      - Math.floor(Math.random() * cells.length) -> ëœë¤ ìƒì„±
      - cells[rand].classList.add("mole")
      - cells[rand].textContent = "ğŸ¹"
      */

      function showMole() {
        // ëª¨ë“  ì…€ ë‘ë”ì§€ë¥¼ ì œê±°
        // cells.forEach((c) => {
        //   (c.classList.remove("mole"), (c.textContent = ""));
        // });
        // ë‘ë²ˆì§¸ ì´í›„ ì´ì „ currentIndexì˜ ìš”ì†Œ ì´ˆê¸°í™”
        if (currentIndex !== -1) {
          cells[currentIndex].classList.remove("mole");
          cells[currentIndex].textContent = "";
        }
        // random(0 ~ 8) -> index
        const rand = Math.floor(Math.random() * cells.length);
        currentIndex = rand;
        // console.log(rand);
        // set
        cells[rand].classList.add("mole");
        cells[rand].textContent = "ğŸ¹";
      }

      // 3. í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
      /*
      [ë¬¸ì œ 3]
      - ëª¨ë“  ì…€ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.
      - í´ë¦­í•œ ì…€ì˜ ì¸ë±ìŠ¤(dataset.index)ì™€ currentIndexë¥¼ ë¹„êµí•œë‹¤.
      - ë‘ë”ì§€ê°€ ìˆëŠ” ì…€ì„ í´ë¦­í–ˆë‹¤ë©´ scoreë¥¼ 1 ì¦ê°€ì‹œí‚¨ë‹¤.
      - ë³€ê²½ëœ ì ìˆ˜ë¥¼ scoreElì— í‘œì‹œí•œë‹¤.

      â€» íŒíŠ¸:
      - cells.forEach(cell => { ... })
      - cell.addEventListener("click", () => { ... })
      - Number(cell.dataset.index) === currentIndex
      - score++
      - scoreEl.textContent = score
      */
      cells.forEach((cell) => {
        // ì´ë²¤íŠ¸ ì¶”ê°€
        cell.addEventListener("click", () => {
          // ê²Œì„ì´ ì‹œí–‰ì¤‘ì´ë©´ ì ìˆ˜ ê³„ì‚°
          if (!timer) return;
          // ì¸ë±ìŠ¤ê°€ ê°™ìœ¼ë©´ ìŠ¤ì½”ì–´ ì¶”ê°€, ë©”ì‹œì§€ ìˆ˜ì •
          if (Number(cell.dataset.index) === currentIndex) {
            score++;
            scoreEl.textContent = score;
          } else {
            miss++;
            missEl.textContent = miss;
          }
        });
      });

      // 4. ê²Œì„ ì‹œì‘ ë²„íŠ¼
      /*
      [ë¬¸ì œ 4]
      - ì‹œì‘ ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.
      - ì´ë¯¸ ê²Œì„ì´ ì§„í–‰ ì¤‘ì´ë©´(timerê°€ ìˆìœ¼ë©´) í•¨ìˆ˜ë¥¼ ì¢…ë£Œí•œë‹¤.
      - ê²Œì„ ì‹œì‘ ì‹œ scoreë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ê³  í™”ë©´ì— í‘œì‹œí•œë‹¤.
      - setInterval()ì„ ì‚¬ìš©í•˜ì—¬ 0.8ì´ˆë§ˆë‹¤ showMole() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.
      - setTimeout()ì„ ì‚¬ìš©í•˜ì—¬ 10ì´ˆ í›„ ê²Œì„ì„ ì¢…ë£Œí•œë‹¤.
      - ê²Œì„ ì¢…ë£Œ ì‹œ: clearInterval()ë¡œ íƒ€ì´ë¨¸ ì¤‘ì§€, timerë¥¼ nullë¡œ ì´ˆê¸°í™”,
        alert()ë¡œ ìµœì¢… ì ìˆ˜ë¥¼ í‘œì‹œí•œë‹¤.

      â€» íŒíŠ¸:
      - startBtn.addEventListener("click", () => { ... })
      - if (timer) return;
      - timer = setInterval(showMole, 800)
      - setTimeout(() => { ... }, 10000)
      - clearInterval(timer)
      - alert("ê²Œì„ ì¢…ë£Œ! ì ìˆ˜: " + score)
      */

      // ê²Œì„ ì¢…ë£Œ / ì´ˆê¸°í™”
      function resetGame(isTimeout) {
        // timer, timeoutId ì´ˆê¸°í™”
        clearInterval(timer);
        timer = null;
        // timeout -> ì ìˆ˜ ì¶œë ¥
        // ì•„ë‹ˆë©´ -> íƒ€ì´ë¨¸ ê°•ì œ ì¢…ë£Œ
        if (isTimeout) {
          // score ì¶œë ¥
          alert("ê²Œì„ ì¢…ë£Œ! ì ìˆ˜: " + score);
        } else {
          // íƒ€ì´ë¨¸ ê°•ì œ ì¢…ë£Œ
          clearTimeout(timeoutId);
          timeoutId = null;
        }
        // startBtn, scoreì´ˆê¸°í™”
        startBtn.textContent = "ê²Œì„ ì‹œì‘";
        score = 0;
        scoreEl.textContent = score;
        // miss ì´ˆê¸°í™”
        miss = 0;
        missEl.textContent = miss;
      }

      // ì´ë²¤íŠ¸ ì¶”ê°€
      startBtn.addEventListener("click", () => {
        // í˜„ì¬ ì‹¤í–‰ì¤‘
        if (timer) {
          // ì´ˆê¸°í™” -> ê°•ì œ ì¢…ë£Œ
          resetGame(false);
          return;
        }
        // ë²„íŠ¼ ê¸€ -> ê²Œì„ ì¢…ë£Œ
        startBtn.textContent = "ê²Œì„ ì¢…ë£Œ";
        // ê²Œì„ ì‹œì‘ -> 0.8ì´ˆë§ˆë‹¤ showMole()í˜¸ì¶œ
        timer = setInterval(showMole, 800);
        // íƒ€ì´ë¨¸
        timeoutId = setTimeout(() => {
          resetGame(true);
        }, 10000);
      });
    </script>
  </body>
</html>
