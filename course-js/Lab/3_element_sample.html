<!-- 
과제!
- 1단계: 코드 이해 (주석 작성: JS를 이용하여 HTML element 조정 방법 확인)
- 2단계: “동일 기능”을 다른 구조로 재작성
- 3단계: 기능 1개 “자유 확장” 
-->

<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DOM CRUD Practice</title>
</head>
<body>
  <h2>DOM CRUD (Add / Delete / Edit)</h2>
  <!-- ==========  입력  ========== -->
  <input id="txt" type="text" placeholder="할 일을 입력" />
  <button id="btnAdd">추가</button>
  <!-- ==========  출력  ========== -->
  <ul id="list"></ul>

  <script>
    // =========== getElementById =================
    const txt = document.getElementById("txt"); // 할일 내용 
    const btnAdd = document.getElementById("btnAdd"); // 추가 버튼
    const list = document.getElementById("list"); // 내용을 출력하는 ul

    // =========== list에 넣는 요소 작성 ==============
    function createItem(text) {
      // ---------------- 요소 생성 -----------------
      // ---- [span] -> 할일 내용
      const span = document.createElement("span");
      span.textContent = text;
      // ---- [input] -> type, 내용, 출력 x
      const input = document.createElement("input");
      input.type = "text";
      input.value = text;
      input.style.display = "none";
      // ---- [button] -> 수정
      const btnEdit = document.createElement("button");
      btnEdit.textContent = "수정";
      // ---- [button] -> 저장, 출력 x
      const btnSave = document.createElement("button");
      btnSave.textContent = "저장";
      btnSave.style.display = "none";
      // ---- [button] -> 취소, 출력 x
      const btnCancel = document.createElement("button");
      btnCancel.textContent = "취소";
      btnCancel.style.display = "none";
      // ---- [button] -> 삭제
      const btnDel = document.createElement("button");
      btnDel.textContent = "삭제";
      
      // ================= [수정] =======================
      // 수정 전 입력 내용저장
      let prevText = text;
      // ===========  수정 모드로 전환  ===========
      function enterEditMode() {
        prevText = span.textContent; // 초기화
        input.value = prevText;
        // ----- 요소 표시 설정 
        // 입력창을 출력
        span.style.display = "none";
        input.style.display = "";
        // 버튼 -> 저장, 취소 출력
        btnEdit.style.display = "none";
        btnSave.style.display = "";
        btnCancel.style.display = "";
        btnDel.disabled = true; // 비 활성화

        input.focus();
        input.select();
      }

      // ============  수정 종료  =============
      function exitEditMode() {
        // ----- 요소 표시 설정 
        span.style.display = "";
        input.style.display = "none";
        btnEdit.style.display = "";
        btnSave.style.display = "none";
        btnCancel.style.display = "none";
        btnDel.disabled = false;
      }
      
      // ===========================================
      // 수정 버튼을 클릭하면 enterEditMode() 실행
      btnEdit.addEventListener("click", enterEditMode);
      // ====  수정 내용 저장  ====
      btnSave.addEventListener("click", () => {
        // -> 입력 내용이 있으면 textContent에 저장
        const value = input.value.trim();
        if (!value) return;
        span.textContent = value;
        exitEditMode();
      });
      // ====  수정 취소  ====
      btnCancel.addEventListener("click", () => {
        // input.value와 상관없이 기존의 prevText로 되돌이기
        span.textContent = prevText;
        exitEditMode();
      });
      // ====  항목 삭제  ====
      btnDel.addEventListener("click", () => li.remove());
      // ==========  키보드 입력  ==========
      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") btnSave.click();
        if (e.key === "Escape") btnCancel.click();
      });
      
      // ================================================
      // 요소들을 li로 묶어서 반환
      const li = document.createElement("li");
      li.appendChild(span);
      li.appendChild(input);
      li.appendChild(document.createTextNode(" "));
      li.appendChild(btnEdit);
      li.appendChild(btnSave);
      li.appendChild(btnCancel);
      li.appendChild(btnDel);

      return li;
    }

    // =================================================
    // 추가 버튼 클릭시 
    btnAdd.addEventListener("click", () => {
      const value = txt.value.trim();
      if (!value) return;
      // 요소들의 덩어리를 list에 추가 
      list.appendChild(createItem(value));
      // 추가 후 초기화
      txt.value = "";
      txt.focus();
    });
    
    // ==========  키보드 입력  ==========
    txt.addEventListener("keydown", (e) => {
      if (e.key === "Enter") btnAdd.click();
    });
  </script>
</body>
</html>
